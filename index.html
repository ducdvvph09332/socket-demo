<!DOCTYPE html>
<html>
  <head>
    <title>Socket.IO Duc Dinh</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <style>
      /* Chrome, Safari, Edge, Opera */
      input::-webkit-outer-spin-button,
      input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      /* Firefox */
      input[type="number"] {
        -moz-appearance: textfield;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="" id="user_name"></div>
      <ul id="messages"></ul>
      <audio id="audio"></audio>
      <form action="">
        <div id="" class="notify_for">
          <label for="">Notify for</label>
          <select id="notify_for" class="custom-select sections" readonly>
            <option value="all" selected>All</option>
          </select>
        </div>
        <div class="mt-3">
          <label for="">Light</label>
          <select id="light" class="custom-select sections" readonly>
            <option value="1">Dark</option>
            <option value="2">Moonlight</option>
            <option value="3">Light</option>
            <option value="4">Sunlight</option>
          </select>
        </div>
        <div class="form-group mt-3">
          <label for="">Temperature</label><br />
          <input
            type="number"
            id="temp"
            autocomplete="off"
            class="form-control sections"
          /><br />
        </div>
        <button class="btn btn-primary">Submit</button>
      </form>
    </div>
  </body>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script>
    $(() => {
      var socket = io();
      //count user
      socket.on("user-connected", (data) => {
        if (data > 1) {
          $(".btn").hide();
          $(".sections").prop("readonly", true);
          $(".sections").prop("disabled", true);
          $(".notify_for").hide();
          //get user information
          var user_info = prompt("What your name?");
          socket.emit("user-info", user_info);
        }
      });
      //
      //submit server
      $("form").submit((e) => {
        e.preventDefault(); // prevents page reloading
        let data = {
          light: $("#light").val(),
          temp: $("#temp").val(),
          notify_for: $("#notify_for").val(),
        };
        socket.emit("msg-sent", data);
        return false;
      });
      // save change text
      socket.on("save", (data) => {
        $("#messages").html($("<li>").text(`${data}`));
        $("#messages li").click(() => {
          $("#messages li").remove();
        });
      });
      // new changes client
      socket.on("msg", (data) => {
        $("#audio").attr("autoplay", true);
        $("#audio").append($("<source>").attr("src", "/sound"));
        $("#messages").html($("<li>").text("New changes"));
        $("#light").val(`${data.light}`);
        $("#temp").val(`${data.temp}`);
        $("#messages li").click(() => {
          $("#messages li").remove();
          $("#audio source").remove();
          $("#audio").removeAttr("autoplay");
        });
      });
      //render user name
      socket.on("user-name", (data) => {
        $("#user_name").text(`Hello, ${data}`);
        $("title").text(`Socket.IO | ${data}`)
      });
      //render notify for
      socket.on("notify-for", (data) => {
        $("#notify_for").append(
          `<option value="${data.user_id}">${data.user_name}</option>`
        );
      });
    });
  </script>
</html>
